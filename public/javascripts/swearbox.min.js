var app=angular.module("AppISB",[]);app.service("membersService",["$http",function($http){var urlBase="/members";this.getMembers=function(){return $http.get(urlBase)},this.increaseDebt=function(id){return $http.put(urlBase+"/increase/"+id)},this.addMember=function(data){return $http.post(urlBase,data)},this.deleteMember=function(id){return $http["delete"](urlBase+"/"+id)},this.dischargeMember=function(id){return $http.put(urlBase+"/discharge/"+id,{})},this.updateNameFirstname=function(id,data){return $http.put(urlBase+"/name/"+id,data)},this.updatePicture=function(id,fd,data){return $http.put(urlBase+"/picture/"+id,fd,data)}}]),app.service("userService",["$http",function($http){var urlBase="/user";this.getAmount=function(){return $http.get("/amount")},this.updateAmount=function(data){return $http.put(urlBase,data)}}]),app.controller("adminCtrl",["$scope","$http","membersService","userService",function($scope,$http,membersService,userService){function getAmount(){userService.getAmount().success(function(amount){$scope.amountTag=amount}).error(function(error){alert("Unable to load amount data: "+error.message)})}function getMembers(){membersService.getMembers().success(function(membs){$scope.members=membs,getRange()}).error(function(error){alert("Unable to load members data: "+error.message)})}function getRange(){$scope.range=[];for(var i=0;i<$scope.members.length/$scope.itemsPerPage;i++)$scope.range.push(i+1)}function ModalShow(vModal){$(vModal).modal("show")}function ModalHide(vModal){$(vModal).modal("hide")}function ChargementImage(s,h){$(s).show(),$(h).hide()}$scope.idImage=0,$scope.numPage=0,$scope.itemsPerPage=5,$scope.newMember={},$scope.newMember.name="",$scope.modMember={},getMembers(),getAmount(),$scope.updateAmount=function(){var dataObj={amount:$scope.amount};userService.updateAmount(dataObj).success(function(){$scope.amountTag=$scope.amount,$scope.amount=""}).error(function(error){alert("Unable to update the penalty amount: "+error.message)})},$scope.addMember=function(){var dataObj={name:$scope.newMember.name,firstname:$scope.newMember.firstname};membersService.addMember(dataObj).success(function(){getMembers(),$scope.newMember.name="",$scope.newMember.firstname=""}).error(function(error){alert("Unable to add a new member: "+error.message)})},$scope.deleteMember=function(){$scope.members.length%$scope.itemsPerPage==1&&$scope.idx+1==$scope.members.length&&1!==$scope.members.length&&($scope.numPage=$scope.numPage-1),$scope.members.splice($scope.idx,1),membersService.deleteMember($scope.idt).success(function(){ModalHide("#deleteMember"),getMembers()}).error(function(error){alert("Unable to delete a member: "+error.message)})},$scope.dischargeMember=function(){membersService.dischargeMember($scope.idt).success(function(){ModalHide("#dischargeMember"),getMembers()}).error(function(error){alert("Unable to discharge a member: "+error.message)})},$scope.modifyMember=function(){var dataObj={name:$scope.modMember.name,firstname:$scope.modMember.firstname};membersService.updateNameFirstname($scope.idt,dataObj).success(function(){ModalHide("#modifyMember"),getMembers(),$scope.modMember.name="",$scope.modMember.firstname=""}).error(function(error){alert("Unable to update the penalty amount: "+error.message)})},$scope.onChange=function(){var file=document.getElementById("hiddenfile").files[0],fd=new FormData;ChargementImage("#span-load"+$scope.idImage,"#img"+$scope.idImage),fd.append("file",file);var dataObj={transformRequest:angular.identity,headers:{"Content-Type":void 0}};membersService.updatePicture($scope.idImage,fd,dataObj).success(function(){getMembers(),ChargementImage("#img"+$scope.idImage,"#span-load"+$scope.idImage)}).error(function(error){alert("Unable to change member picture: "+error.message)})},$scope.openDeleteModal=function(idx,idt,firstname,name){$scope.idx=idx,$scope.idt=idt,$scope.firstname=firstname,$scope.name=name,ModalShow("#deleteMember")},$scope.openDischargeModal=function(idt,firstname,name){$scope.idt=idt,$scope.firstname=firstname,$scope.name=name,ModalShow("#dischargeMember")},$scope.openModifyModal=function(idt,firstname,name){$scope.idt=idt,$scope.modMember.firstname=firstname,$scope.modMember.name=name,ModalShow("#modifyMember")},$scope.pagination=function(id){$scope.numPage=id},$scope.browseImage=function(idt){$("#hiddenfile").click(),$scope.idImage=idt},$scope.isNumeric=function(event){return(event.which<48||event.which>57)&&0!==event.which&&8!==event.which?(event.preventDefault(),!1):void 0}}]),app.controller("statsCtrl",["$scope","$http",function($scope,$http){function getStats(){$http.get("/stats").success(function(data){$scope.stats=data}).error(function(){alert("Unable to load stats data")}),drawStats()}function drawStats(){{var s1=[5,4,2,8,5,4,9,6,5,4,1,8],s2=[3,1,9,2,8,1,5,3,2,1,3,7],ticks=["JAN","FEV","MAR","AVR","MAI","JUN","JUL","AOU","SEP","OCT","NOV","DEC"];$.jqplot("chart1",[s1,s2],{seriesColors:["#428bca","#5cb85c"],seriesDefaults:{pointLabels:{show:!0},shadow:!1,shadowOffset:0,renderer:$.jqplot.BarRenderer,rendererOptions:{fillToZero:!0,highlightMouseOver:!1,barPadding:1,barMargin:5}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:ticks},yaxis:{showTicks:!1}}})}}$scope.stats={},getStats()}]),app.controller("userCtrl",["$scope","membersService",function($scope,membersService){function getMembers(){membersService.getMembers().success(function(membs){$scope.members=membs,getRange()}).error(function(error){alert("Unable to load members data: "+error.message)})}function getRange(){$scope.range=[];for(var i=0;i<$scope.members.length/$scope.itemsPerPage;i++)$scope.range.push(i+1)}$scope.numPage=0,$scope.itemsPerPage=5,getMembers(),$scope.increase=function(id){membersService.increaseDebt(id).success(function(){getMembers()}).error(function(error){alert("Unable to increase member debt: "+error.message)})},$scope.pagination=function(id){$scope.numPage=id}}]);